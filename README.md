![](http://dev.lutece.paris.fr/jenkins/buildStatus/icon?job=gru-library-identitystore-deploy)
# Library Identitystore

## Introduction

This library provides services to communicate with Identity Store REST API V3 to read, update or create identities according to the rights of the service contract.

## Services

The main services are :
*  `fr.paris.lutece.plugins.identitystore.web.service.IdentityService` which provides methods for Identities.
* `fr.paris.lutece.plugins.identitystore.web.service.ServiceContractService` which provides methods for service contracts.
 </li>
 <li>
* a `ServiceContractCache` that provides cache for service contracts.


They  require  implementations of `IIdentityTransportProvider` and `IServiceContractTransportProvider` to define the HTTP transport. Two implementations of HTTPTransport are provided in the library :

*  `fr.paris.lutece.plugins.identitystore.web.rs.service.HTTPApiManagerAccessTransport` , to use an  ApiManager with an OAuth authorization process to get a token from an access manager, in order to secure requests to the API.
*  `fr.paris.lutece.plugins.identitystore.web.rs.service.HTTPAccessTransport`, which provides direct requests.


Both implementations require URL definition of the Identity Store service end point. This URL is stored in the attribute `ApiEndPointUrl`.

The HTTPApiManagerAccessTransport requires `AccessManagerEndPointUrl` and `AccessManagerCredentials` extra properties.

## Configuration using Spring context

* define the bean for the HTTP transport you want to use,
* define the beans for the implementations of the transport for the services  `IdentityService` or  `ServiceContractService` ,
* define the beans for the services  `IdentityService` or  `ServiceContractService` .



Here is an example of Spring configuration with the HTTP transport `HttpApiManagerAccessTransport` :

```
    <!-- IHttpTransportProvider declarations -->
    <bean id="identitystore.httpAccessTransport" class="fr.paris.lutece.plugins.identitystore.v3.web.rs.service.HttpApiManagerAccessTransport" >
	<property name="ApiEndPointUrl">
            <value>${identitydesk.identitystore.ApiEndPointUrl}</value>
        </property>
	<property name="AccessManagerEndPointUrl">
            <value>${identitydesk.identitystore.AccessManagerEndPointUrl}</value>
        </property>
	<property name="AccessManagerCredentials">
            <value>${identitydesk.identitystore.AccessManagerCredentials}</value>
        </property>
     </bean>

    <bean id="identity.restTransport.httpAccess" class="fr.paris.lutece.plugins.identitystore.v3.web.rs.service.IdentityTransportRest">
        <constructor-arg ref="identitystore.httpAccessTransport"/>
    </bean>
     <bean id="serviceContract.restTransport.httpAccess" class="fr.paris.lutece.plugins.identitystore.v3.web.rs.service.ServiceContractTransportRest">
        <constructor-arg ref="identitystore.httpAccessTransport"/>
    </bean>


    <!-- IdentityService impl -->
    <bean id="identity.identityService" class="fr.paris.lutece.plugins.identitystore.v3.web.service.IdentityService">
        <constructor-arg ref="identity.restTransport.httpAccess"/>
    </bean>

    <!-- ServiceContractService impl -->
    <bean id="identity.serviceContractService" class="fr.paris.lutece.plugins.identitystore.v3.web.service.ServiceContractService">
        <constructor-arg ref="serviceContract.restTransport.httpAccess"/>
    </bean>

    <!-- Cache -->
    <bean id="identity.serviceContractCacheService"  class="fr.paris.lutece.plugins.identitydesk.cache.ServiceContractCache">
        <constructor-arg ref="identity.serviceContractService"/>
    </bean>

```

properties :

```
identitydesk.default.client.code=TEST

identitydesk.identitystore.ApiEndPointUrl=https://gru-gravitee-apim-gateway.rec.apps.paris.mdp/identity
identitydesk.identitystore.AccessManagerEndPointUrl=https://gru-gravitee-am-gateway.rec.apps.paris.mdp/gru-notifications-domain/oauth/token
identitydesk.identitystore.AccessManagerCredentials=THE_AM_TOKEN_SD4JF5fss5IGL4PAPZINBQ5IDinvp45osfgS
```

Here is an example of Spring configuration with the HTTP transport `HttpAccessTransport` :

```
    <!-- IHttpTransportProvider declarations -->
    <bean id="identitystore.httpAccessTransport" class="fr.paris.lutece.plugins.identitystore.v3.web.rs.service.HttpAccessTransport" >
	      <property name="ApiEndPointUrl">
            <value>${identitydesk.identitystore.ApiEndPointUrl}</value>
        </property>
     </bean>

     ...

```




[Maven documentation and reports](http://dev.lutece.paris.fr/plugins/library-identitystore/)



 *generated by [xdoc2md](https://github.com/lutece-platform/tools-maven-xdoc2md-plugin) - do not edit directly.*
